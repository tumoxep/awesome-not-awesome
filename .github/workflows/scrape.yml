name: Scrape Trending Repos & Prepare PR

on:
  workflow_dispatch:    # allows manual run on demand
  schedule:
    - cron: '0 1 * * *'     # every day at 01:00 UTC
    - cron: '0 1 * * 0'     # every week at 01:00 UTC Sunday
    - cron: '0 1 1 * *'     # every month at 01:00 UTC on the 1st

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install requests beautifulsoup4

      - name: Run scraper
        run: python scripts/scrape_trending.py

      - name: Commit and create PR
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "Update trending repo candidates for review"
          title: "Trending candidate list update"
          body: |
            Automated update of trending repos for review. Please mark any 'not awesome' candidates in the README.
          branch: auto/trending-update
          base: master